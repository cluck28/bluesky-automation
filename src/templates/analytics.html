{% extends "base.html" %}
{% block content %}
<div class="profile-header">
    <div class="profile-info">
        <h1>{{ handle }}</h1>
        <p class="tagline">Keeping it smooth and engaging üí´</p>
        <div class="follow-stats">
            <div class="stat">
                <span class="stat-number">{{ followers }}</span>
                <span class="stat-label">Followers</span>
            </div>
            <div class="stat">
                <span class="stat-number">{{ following }}</span>
                <span class="stat-label">Following</span>
            </div>
            <div class="stat">
                <span class="stat-number">{{ posts }}</span>
                <span class="stat-label">Posts</span>
            </div>
            <div class="stat">
                <span class="stat-number">{{ engagement_rate }}%</span>
                <span class="stat-label">Engagement</span>
            </div>
        </div>
        <br></br>
        <p class="fun-stats">üíå That's {{ average_likes }} likes per post ‚Äî your audience loves you üòè</p>

        <!-- New section for top posts -->
        <p class="fun-stats">Here are your top performing posts</p>
        <div class="top-posts">
            <div class="top-post">
                <div class="top-post-container">
                    <img src="{{ top_liked_post_img }}" alt="Most Liked Post">
                    <div class="top-post-overlay">
                        <span>{{ top_likes_count }}</span>
                    </div>
                </div>
                <span class="top-post-label">Most Liked</span>
            </div>
            <div class="top-post">
                <div class="top-post-container">
                    <img src="{{ top_bookmarked_post_img }}" alt="Most Bookmarked Post">
                    <div class="top-post-overlay">
                        <span>{{ top_bookmarked_count }}</span>
                    </div>
                </div>
                <span class="top-post-label">Most Bookmarked</span>
            </div>
            <div class="top-post">
                <div class="top-post-container">
                    <img src="{{ top_reposted_post_img }}" alt="Most Reposted Post">
                    <div class="top-post-overlay">
                        <span>{{ top_reposted_count }}</span>
                    </div>
                </div>
                <span class="top-post-label">Most Reposted</span>
            </div>
        </div>
    </div>
</div>
<div class="analytics-container">
    <h1>Analytics Dashboard</h1>
        <!-- Aggregation Selector -->
        <form id="periodForm" method="GET" action="/analytics" style="margin-bottom: 20px;">
            <label for="periodSelect">Aggregation Period:</label>
            <select name="period" id="periodSelect" onchange="document.getElementById('periodForm').submit()">
                <option value="day" {% if request.args.get('period') == 'day' %}selected{% endif %}>Daily</option>
                <option value="week" {% if request.args.get('period') == 'week' %}selected{% endif %}>Weekly</option>
                <option value="month" {% if request.args.get('period') == 'month' or not request.args.get('period') %}selected{% endif %}>Monthly</option>
                <option value="quarter" {% if request.args.get('period') == 'quarter' %}selected{% endif %}>Quarterly</option>
                <option value="year" {% if request.args.get('period') == 'year' %}selected{% endif %}>Yearly</option>
            </select>
        </form>
       <!-- Chart + Text Pairs -->
    <div class="chart-row">
        <div class="chart-text">
            <h2>Total Posts per Period</h2>
            <p>This shows the total number of posts you‚Äôve made during each period. Use this to track how consistently you‚Äôre sharing content over time.</p>
        </div>
        <div class="chart-box">
            <canvas id="totalPostsChart"></canvas>
        </div>
    </div>

    <div class="chart-row">
        <div class="chart-text">
            <h2>Total Likes per Period</h2>
            <p>This chart displays the total likes your posts received for each period. It‚Äôs a simple pulse check on engagement growth.</p>
        </div>
        <div class="chart-box">
            <canvas id="totalLikesChart"></canvas>
        </div>
    </div>

    <div class="chart-row">
        <div class="chart-text">
            <h2>Average Likes per Period</h2>
            <p>This shows your average likes per post. A higher average means your content is performing consistently well‚Äîeven if you post less frequently.</p>
        </div>
        <div class="chart-box">
            <canvas id="averageLikesChart"></canvas>
        </div>
    </div>
    <div class="chart-row">
        <div class="chart-text">
            <h2>Total Interactions per Period</h2>
            <p>This shows the total interactions your posts have received during each period. Use this to see how engagement with your content changes over time and which types of interactions are driving it.</p>
        </div>
        <div class="chart-box">
            <canvas id="totalInteractionsStackedChart"></canvas>
        </div>
    </div>
    <div class="chart-row">
        <div class="chart-text">
            <h2>Average Interactions per Period</h2>
            <p>This shows the average number of interactions your posts receive during each period. Use this to track how engaging your content is over time.</p>
        </div>
        <div class="chart-box">
            <canvas id="averageInteractionsStackedChart"></canvas>
        </div>
    </div>
    <div class="chart-row">
        <div class="chart-text">
            <h2>Average Likes by Media Type per Period</h2>
            <p>This shows the average number of likes broken out by media type. This lets you see if your images are outperforming your videos.</p>
        </div>
        <div class="chart-box">
            <canvas id="averageLikesByTypeStackedChart"></canvas>
        </div>
    </div>
</div>

<script>
    const chartData1 = {{ total_likes | tojson }};
    const chartData2 = {{ avg_likes | tojson }};
    const chartData3 = {{ total_posts | tojson }};
    const chartData4 = {{ stacked_totals | tojson }};
    const chartData5 = {{ stacked_averages | tojson }};
    const chartData6 = {{ average_likes_by_type | tojson }};
    
    const ctx1 = document.getElementById('totalLikesChart').getContext('2d');
    const ctx2 = document.getElementById('averageLikesChart').getContext('2d');
    const ctx3 = document.getElementById('totalPostsChart').getContext('2d');
    const ctx4 = document.getElementById('totalInteractionsStackedChart').getContext('2d');
    const ctx5 = document.getElementById('averageInteractionsStackedChart').getContext('2d');
    const ctx6 = document.getElementById('averageLikesByTypeStackedChart').getContext('2d');
    new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: chartData1.labels,
            datasets: [{
                label: 'Total Likes',
                data: chartData1.values,
                backgroundColor: 'rgba(75, 192, 192, 0.4)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#eee'
                    }
                }
            }
        }
    });
    new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: chartData2.labels,
            datasets: [{
                label: 'Average Likes',
                data: chartData2.values,
                backgroundColor: 'rgba(75, 192, 192, 0.4)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#eee'
                    }
                }
            }
        }
    });
    new Chart(ctx3, {
        type: 'bar',
        data: {
            labels: chartData3.labels,
            datasets: [{
                label: 'Total Posts',
                data: chartData3.values,
                backgroundColor: 'rgba(75, 192, 192, 0.4)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#eee'
                    }
                }
            }
        }
    });
    new Chart(ctx4, {
        type: 'bar',
        data: chartData4,
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#eee'
                    }
                }
            }
        }
    });
    new Chart(ctx5, {
        type: 'bar',
        data: chartData5,
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#eee'
                    }
                }
            }
        }
    });
    new Chart(ctx6, {
        type: 'bar',
        data: chartData6,
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255,255,255,0.1)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#eee'
                    }
                }
            }
        }
    });
</script>
{% endblock %}
